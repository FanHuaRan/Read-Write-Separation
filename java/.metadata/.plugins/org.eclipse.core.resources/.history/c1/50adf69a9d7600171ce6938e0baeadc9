package com.fhr.readwritedemo.components;

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

import org.apache.log4j.Logger;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.support.WebApplicationContextUtils;

import com.fhr.readwritedemo.core.services.IDSMonitor;
import com.fhr.readwritedemo.core.services.impl.UdpDSMonitor;

/**
 * web生命周期监听器
 * @author fhr
 * @date 2017/07/12
 */
public class InitListener implements ServletContextListener {
	private static final Logger logger = Logger.getLogger(InitListener.class);
	
	//数据库服务器监控器
	private IDSMonitor dsMonitor=null;
	
	@Override
	public void contextDestroyed(ServletContextEvent arg0) {
	}

	@Override
	public void contextInitialized(ServletContextEvent arg0) {
		//获取spring上下文
		WebApplicationContext springContext = WebApplicationContextUtils
				.getWebApplicationContext(arg0.getServletContext());
		if (springContext == null) {
			logger.error("初始化错误 未找到spring上下文");
		} else {
			dsMonitor = (IDSMonitor) springContext.getBean(UdpDSMonitor.class);
			if (dsMonitor != null) {
				new Thread(() -> {
					try {
						officeToPDF.start();
					} catch (InterruptedException e) {
						e.printStackTrace();
					}
				}).start();
			} else {
				logger.error("初始化错误 未找到office服务组件");
			}
		}
	}

}
